{% extends "base.html" %}

{% block title %}CLERK â€” Reasoning Kits{% endblock %}

{% block content %}
<div class="fade-in">
    <!-- Platform intro -->
    <div class="mb-12">
        <h1 class="text-4xl font-bold text-foreground mb-3 tracking-tight">CLERK</h1>
        <p class="text-muted-foreground text-base max-w-xl leading-relaxed">
            Community Library of Executable Reasoning Kits. Create, manage, and share
            multi-step LLM reasoning workflows. Each kit defines a sequence of prompts
            that build on each other, turning complex reasoning into reproducible pipelines.
        </p>
        <p class="text-muted-foreground text-base max-w-xl leading-relaxed mt-2">
            Kits can be public or private. <a href="/auth/signup" class="text-primary hover:underline font-medium">Sign
                up</a> to create and manage your own kits.
        </p>
    </div>

    <!-- Page header -->
    <div class="flex items-end justify-between mb-8">
        <div>
            <h2 class="text-2xl font-semibold text-foreground tracking-tight">Reasoning Kits</h2>
            <p class="text-muted-foreground mt-1">Browse and run executable reasoning workflows</p>
        </div>
        {% if user %}
        <a href="/kit/new" class="btn btn-primary">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            New Kit
        </a>
        {% endif %}
    </div>

    <!-- Search & filter row -->
    <div class="flex items-center gap-4 mb-8 flex-wrap">
        <input type="search" id="kit-search" name="q" placeholder="Search kits..." class="input max-w-md"
            hx-get="/api/search" hx-trigger="input changed delay:300ms, search" hx-target="#kit-list"
            hx-indicator="#search-indicator" hx-include="#kit-filter-value">
        <span id="search-indicator" class="htmx-indicator ml-2">
            <span class="pulse-dot"></span>
            <span class="pulse-dot"></span>
            <span class="pulse-dot"></span>
        </span>

        {% if user %}
        <!-- All / My Kits toggle -->
        <div class="kit-filter-toggle ml-auto">
            <button type="button" class="kit-filter-btn active" data-filter="all" hx-get="/api/search"
                hx-target="#kit-list" hx-include="#kit-search" hx-vals='{"filter": "all"}'
                hx-indicator="#search-indicator">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 017.843 4.582M12 3a8.997 8.997 0 00-7.843 4.582m15.686 0A11.953 11.953 0 0112 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0121 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0112 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 013 12c0-1.605.42-3.113 1.157-4.418" />
                </svg>
                All Kits
            </button>
            <button type="button" class="kit-filter-btn" data-filter="mine" hx-get="/api/search" hx-target="#kit-list"
                hx-include="#kit-search" hx-vals='{"filter": "mine"}' hx-indicator="#search-indicator">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                </svg>
                My Kits
            </button>
        </div>
        <input type="hidden" id="kit-filter-value" name="filter" value="all">
        {% endif %}
    </div>

    <!-- Kit grid -->
    <div id="kit-list">
        {% include "partials/kit_list.html" %}
    </div>
</div>

{% if user %}
<script>
    (function () {
        var toggle = document.querySelector('.kit-filter-toggle');
        var hiddenInput = document.getElementById('kit-filter-value');
        var searchInput = document.getElementById('kit-search');
        if (!toggle) return;

        toggle.addEventListener('click', function (e) {
            var btn = e.target.closest('.kit-filter-btn');
            if (!btn) return;
            toggle.querySelectorAll('.kit-filter-btn').forEach(function (b) {
                b.classList.remove('active');
            });
            btn.classList.add('active');
            hiddenInput.value = btn.dataset.filter;
        });

        // When searching, also include the active filter
        if (searchInput) {
            searchInput.setAttribute('hx-vals', 'js:{filter: document.getElementById("kit-filter-value").value}');
            htmx.process(searchInput);
        }
    })();
</script>
{% endif %}
{% endblock %}